{% extends 'base.html' %}

{% block title %}Tasks - StudyBox{% endblock %}

{% block extra_css %}

    <link rel="stylesheet" href="{{ url_for('assignments.static', filename='assignment.css') }}">
{% endblock %}

{% block content %}

 <h1>Welcome to the Assignment Tracker!</h1>
 <p>Here you can manage all your assignments for each subject so you don't lose track.<br>
 </p>
    <!-- start the tables by listing all the subjects and their assignments -->
    {% for subject in subjects %}
    <div class="subject-card">
    <h2>{{ subject.subject_name() }}</h2>
    
    <table border = "1">
        <tr>
            <th>Assignment Name</th>
            <th>Deadline</th>
            <th>âœ…</th>
            <th>Status</th>
        </tr>
        {% for assignment in subject.assignments %}
            {% if assignment.assignment != 'Final Exam' %}
            <tr>
                <td>{{assignment.assignment}}</td>
                <td>
                    {% set deadline_info = get_deadline_info(assignment.deadline, now, assignment.done) %}
                    <div class="deadline-container">
                        <form method="POST" >
                            <input type="hidden" name="update_deadline" value="1">
                            <input type="hidden" name="assignment_id" value="{{assignment.id}}">
                            <input type="date" name="deadline" value="{{assignment.deadline.strftime('%Y-%m-%d') if assignment.deadline else ''}}">
                            <button type="submit" style="margin-left: 5px; padding: 2px 5px;">Save</button>
                        </form>
                        {% if deadline_info.urgency != 'no_deadline' and deadline_info.days_remaining is not none %}
                            <div class="days-remaining" style="color: {{ deadline_info.color }};">
                                {% if deadline_info.urgency == 'overdue' %}
                                    {{ deadline_info.days_remaining }} day{{ 's' if deadline_info.days_remaining != 1 else '' }} overdue
                                {% else %}
                                    {{ deadline_info.days_remaining }} day{{ 's' if deadline_info.days_remaining != 1 else '' }} left
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                </td>
                <td>
                    <form method="POST">
                        <input type="hidden" name="assignment_id" value="{{assignment.id}}">
                        {% if assignment.deadline and assignment.deadline < now %}
                            <input type="checkbox" name="done" value="True" {% if assignment.done %}checked{% endif %} disabled>
                        {% else %}
                            <input type="checkbox" name="done" onchange="this.form.submit()" value="True" {% if assignment.done %}checked{% endif %}>
                        {% endif %}
                    </form>
                </td>
                <td>
                    {% if assignment.done %}
                    <span title="done">ðŸŸ¢</span>
                    {% else %}
                        {% if assignment.deadline and (assignment.deadline < now) %}
                            <span title="overdue">ðŸ”´</span>
                        {% else %}
                            <span title="ongoing">ðŸŸ¡</span>
                        {% endif %}
                    {% endif %}

                </td>
            </tr>
            {% endif %}
        {% endfor %}
    </table>
        </div>
    {% endfor %}

{% endblock %}

</html>