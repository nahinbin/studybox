{% extends "base.html" %}

{% block title %}StudyBox - Login{% endblock %}

{% block content %}
<div class="container d-flex align-items-center justify-content-center" style="min-height: 80vh;">
    <div class="row justify-content-center w-100">
        <div class="col-md-5 col-lg-4">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title text-center mb-4">Sign In</h2>
                    
                    {% if error_message %}
                        <div class="alert alert-warning mb-3" role="alert">
                            {{ error_message }}
                            {% if "not verified" in error_message %}
                                <br><small><a href="/resend-verification" class="alert-link">Resend verification email</a></small>
                            {% endif %}
                        </div>
                    {% endif %}
                    
                    <form action="/login" method="POST">
                        {{ form.hidden_tag() }}
                        
                        <!-- Username Field -->
                        <div class="mb-3">
                            {{ form.username(class="form-control", placeholder="Username or Email", autocapitalize="none", autocomplete="username", spellcheck="false", style="text-transform: lowercase;" ) }}
                            <script>
                            (function(){
                              const el = document.querySelector('input[name="username"]');
                              if(el){ el.addEventListener('input', function(){ this.value = this.value.toLowerCase(); }); }
                            })();
                            </script>
                        </div>
                        
                        <!-- Password Field -->
                        <div class="mb-4">
                            <style>
                              .password-toggle-wrap { position: relative; }
                              .password-toggle-btn {
                                position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
                                border: none; background: transparent; padding: 6px; cursor: pointer;
                                color: #6c757d;
                                transition: transform 160ms ease, color 160ms ease;
                              }
                              .password-toggle-btn:active { transform: translateY(-50%) scale(0.92); }
                              .reveal-anim { animation: pulse-reveal 180ms ease; }
                              @keyframes pulse-reveal {
                                0% { transform: scale(0.98); }
                                60% { transform: scale(1.02); }
                                100% { transform: scale(1); }
                              }
                            </style>
                            <div class="password-toggle-wrap">
                                {{ form.password(class="form-control", placeholder="Password", id="login_password") }}
                                <button type="button" class="password-toggle-btn" id="toggle_login_password" aria-label="Show password">
                                  <i class="far fa-eye" id="login_eye"></i>
                                </button>
                            </div>
                            <script>
                              (function(){
                                const input = document.getElementById('login_password');
                                const btn = document.getElementById('toggle_login_password');
                                const eye = document.getElementById('login_eye');
                                if(btn && input && eye){
                                  btn.addEventListener('click', function(){
                                    const isHidden = input.getAttribute('type') === 'password';
                                    input.setAttribute('type', isHidden ? 'text' : 'password');
                                    eye.classList.toggle('fa-eye');
                                    eye.classList.toggle('fa-eye-slash');
                                    input.classList.remove('reveal-anim');
                                    void input.offsetWidth; // restart animation
                                    input.classList.add('reveal-anim');
                                    btn.setAttribute('aria-label', isHidden ? 'Hide password' : 'Show password');
                                  });
                                }
                              })();
                            </script>
                        </div>
                        
                        <!-- Submit Button -->
                        <div class="mb-4">
                            {{ form.submit(class="btn btn-primary w-100") }}
                        </div>
                        <p class="text-center">Don't have an account? <a href="/register">Sign Up</a></p>
                        <p class="text-center"><a href="/forgot-password">Forgot Password?</a></p>
                    </form>
                </div>
            </div>
            <div class="text-center mt-4">
                <a href="/help" class="text-white text-decoration-none small">Having troubles? Click <span class="text-decoration-underline" style="color: #87CEEB;">here</span> for help</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
