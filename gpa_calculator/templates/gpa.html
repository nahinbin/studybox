{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('gpa.static', filename='gpa.css') }}">
<title>GPA Calculator</title>
{% endblock %}

{% block content %}
<h1>GPA Calculator</h1>

<div class="subjects-container">
    {% for item in subjects_with_data %}
    <div class="subject-card">
        <h3>{{ item.subject.subject_name() }}</h3>
        <p class="credits">Credits: {{ item.subject.credit_hours() }}</p>
        
        <div class="subject-gpa">
            {% if item.partial_data.completion > 0 %}
                <p class="gpa-info">
                    <strong>This subject's GPA: {{ item.partial_data.gpa }}</strong>
                </p>
            {% else %}
                <p class="gpa-info no-grades">No grades entered yet</p>
            {% endif %}
        </div>
        
        {% if item.subject.assignments %}
            <div class="assignments">
                {% for t in item.subject.assignments %}
                    <div class="assignment-item">
                        <div class="assignment-header">
                            <strong>{{ t.assignment }}</strong>
                            {% if t.weight %}
                                <span class="weight">({{ (t.weight*100)|round(1) }}%)</span>
                            {% endif %}
                        </div>
                        <form method="POST" class="score-form">
                            <input type="hidden" name="update_task_score" value="1">
                            <input type="hidden" name="task_id" value="{{ t.id }}">
                            <input type="hidden" name="max_score" value="{{ (t.weight*100) if t.weight else 100 }}">
                            <input type="number" name="score" min="0" max="{{ (t.weight*100) if t.weight else 100 }}" step="0.1" value="{{ t.score }}" placeholder="Enter score" required>
                        </form>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
    {% endfor %}
</div>

{% if missed_semesters %}
<div class="previous-semester-section">
    <h3>Missing Previous Semester GPAs</h3>
    <p>To calculate your CGPA accurately, please enter your GPAs for previous semesters:</p>
    
    {% for semester in missed_semesters %}
    <div class="semester-form">
        <h4>{{ semester }}</h4>
        <form method="POST">
            <input type="hidden" name="add_previous_gpa" value="1">
            <input type="hidden" name="semester_name" value="{{ semester }}">
            
            <label>GPA (0.0-4.0):</label>
            <input type="number" name="gpa" min="0" max="4" step="0.01" required>
            
            <button type="submit">Mark as Completed</button>
        </form>
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="gpa-display">
    <!-- red -->
    {% set color = '#e74c3c' %}
    <!-- green -->
    {% if gpa > 3 %}
        {% set color = '#27ae60' %}
    <!-- yellow -->
    {% elif gpa > 2 %}
        {% set color = '#f39c12' %}
    {% endif %}
    
    <div class="gpa-card">
        <h2>Current GPA</h2>
        <div class="gpa-value" style="color: {{ color }};">{{ gpa }}</div>
    </div>
    
    <div class="gpa-card">
        <h2>Cumulative GPA (CGPA)</h2>
        <div class="gpa-value" style="color: #3498db;">{{ cgpa }}</div>
    </div>
</div>



{% endblock %}
